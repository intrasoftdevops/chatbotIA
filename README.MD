# Chatbot de Pol√≠tica y Tribus (RAG con Gemini)

Este es un chatbot conversacional que responde preguntas sobre pol√≠tica colombiana y el sistema de tribus pol√≠ticas, utilizando **Retrieval Augmented Generation (RAG)** para buscar informaci√≥n relevante en documentos y generar respuestas precisas y contextualmente informadas.

## üöÄ **Cambios Recientes**

### **Limpieza y Optimizaci√≥n**
- ‚úÖ **IA Pol√≠tica Gen√©rica**: Eliminadas referencias espec√≠ficas a Daniel Quintero
- ‚úÖ **Configuraci√≥n Segura**: Variables sensibles movidas a `.env`
- ‚úÖ **C√≥digo Limpio**: Eliminados comentarios excesivos y logs verbosos
- ‚úÖ **Documentaci√≥n Actualizada**: Instrucciones claras y concisas

### **Nuevo Comando de Ejecuci√≥n**
```bash
python run_server.py
```

## üéØ **Funcionalidades Principales**

### **1. Respuestas sobre Pol√≠tica Colombiana**
- Consultas sobre partidos pol√≠ticos, democracia, sistema electoral
- Informaci√≥n basada en documentos pol√≠ticos disponibles
- Respuestas contextuales y emp√°ticas

### **2. Sistema de Tribus Pol√≠ticas**
- **Detecci√≥n autom√°tica** de preguntas sobre tribus
- **Informaci√≥n sobre coordinadores** y acceso a grupos
- **Explicaci√≥n del sistema** de voluntarios organizados por regi√≥n
- **Orientaci√≥n** para contactar coordinadores locales

### **3. Patrones de Detecci√≥n de Tribus/Referidos**
El chatbot reconoce autom√°ticamente **60+ variaciones** de preguntas sobre tribus y referidos, incluyendo:
- "M√°ndame el link de mi tribu"
- "Env√≠ame el link de mi tribu"
- "¬øMe puedes mandar el enlace de mi tribu?"
- "P√°same el link de la tribu"
- "¬øD√≥nde est√° el link de mi tribu?"
- "Mandame el link d mi tribu"
- "Enlace tribu porfa"
- "Link tribu ya"
- "Dame el enlace de mi grupo"
- "¬øC√≥mo entro a la tribu?"
- "Parce, m√°ndame el link de mi tribu"
- "Oe, ¬øten√©s el enlace de la tribu?"
- "Mijo, p√°same el link del parche"
- "Necesito el link pa entrar a mi tribu"
- "¬øD√≥nde est√° el bendito link de la tribu?"
- "Quiero entrar a mi tribu"
- "Perd√≠ el link de la tribu"
- "Ay√∫dame con el link de la tribu"
- "Como es que invito gente?"
- "Dame el link"
- **"M√°ndame el link de mis referidos"**
- **"Env√≠ame el enlace de mis referidos"**
- **"¬øMe puedes mandar el link de referidos?"**
- **"P√°same el link de referidos"**
- **"¬øD√≥nde est√° mi enlace de referidos?"**
- **"Parce, m√°ndame el link de mis referidos"**
- **"Link de referidos porfa"**
- **"¬øC√≥mo obtengo mi link de referidos?"**

**Cobertura completa** de expresiones colombianas, jerga local y variaciones informales. **"Tribu" y "referidos" son sin√≥nimos** en el sistema.

### **4. Respuestas Inteligentes**
- **Contextuales**: Adaptadas al tipo de pregunta
- **Informativas**: Explican el sistema de tribus
- **Orientadoras**: Gu√≠an hacia coordinadores locales
- **Emp√°ticas**: Mantienen un tono amigable

### **5. Analytics Integrado**
- **Datos de Rendimiento**: Ranking, posici√≥n geogr√°fica, referidos
- **Respuestas Personalizadas**: Basadas en m√©tricas reales del usuario
- **IA Pol√≠tica Especializada**: An√°lisis de campa√±as pol√≠ticas

El proyecto est√° construido con:

  * **FastAPI**: Para crear la API REST que aloja el chatbot.
  * **LlamaIndex**: Para la gesti√≥n de datos, la creaci√≥n del √≠ndice de conocimiento y la implementaci√≥n de la l√≥gica RAG.
  * **Gemini (Google)**: El modelo de lenguaje grande (LLM) que procesa las preguntas y genera las respuestas.

-----

### Requisitos Previos

Antes de comenzar, aseg√∫rate de tener instalado lo siguiente:

  * **Python 3.11** o superior.
  * **Git** (para la gesti√≥n de c√≥digo).
  * **Una clave API de Gemini** obtenida de [Google AI Studio](https://aistudio.google.com/app/apikey).

-----

### Configuraci√≥n del Entorno

Sigue estos pasos para configurar tu proyecto y sus dependencias.

1.  **Clonar el repositorio:**

    ```bash
    git clone https://github.com/sindresorhus/del
    cd chatbotIA
    ```

2.  **Crear y activar el entorno virtual:**

    ```bash
    python -m venv venv
    source venv/bin/activate
    ```

3.  **Configurar variables de entorno:**

      * Crea un archivo llamado `.env` en la ra√≠z del proyecto.
      * A√±ade las siguientes variables:
        ```env
        # Google API Configuration
        GOOGLE_API_KEY="TU_CLAVE_API_DE_GEMINI"
        
        # Model Configuration (opcional, valores por defecto)
        LLM_MODEL=models/gemini-1.5-flash
        EMBEDDING_MODEL=models/embedding-001
        
        # Storage Configuration (opcional, valor por defecto)
        INDEX_DIR=storage
        ```


4.  **Instalar las dependencias:**

    ```bash
    pip install llama-index-llms-gemini llama-index-embeddings-gemini llama-index pydantic "uvicorn[standard]" google-generativeai fastapi
    ```

-----

### Uso del Proyecto

Una vez que el entorno y las dependencias est√©n configurados, puedes ejecutar el chatbot en dos sencillos pasos.

#### Paso 1: Preparar la Base de Conocimiento

Este comando procesa todos los documentos de la carpeta `data/` y crea un √≠ndice que el chatbot utilizar√°. Solo necesitas ejecutarlo una vez o cada vez que a√±adas o modifiques documentos.

```bash
python prepare_data.py
```

  * **Verificaci√≥n:** Si todo va bien, ver√°s un mensaje que dice "√çndice guardado exitosamente." Se crear√° una carpeta `storage/`.

#### Paso 2: Ejecutar el Servidor del Chatbot

Este comando inicia el servidor web que aloja la API del chatbot. El servidor debe estar corriendo para poder interactuar con el chatbot.

```bash
python run_server.py
```

  * **Verificaci√≥n:** Si todo funciona, ver√°s un mensaje que dice "‚úÖ Chatbot inicializado correctamente" y el servidor estar√° disponible en [http://127.0.0.1:8000](http://127.0.0.1:8000).

-----

### Interactuar con el Chatbot

Mientras el servidor est√° activo, puedes acceder a la interfaz de documentaci√≥n interactiva de FastAPI (Swagger UI) para enviar preguntas.

1.  Abre tu navegador web.
2.  Ve a la siguiente direcci√≥n:
    ```
    http://127.0.0.1:8000/docs
    ```
3.  En la interfaz, expande el endpoint `POST /chat`, haz clic en "Try it out" e introduce tu pregunta en el campo `query`.
4.  Haz clic en "Execute" para obtener una respuesta de tu chatbot.

-----

### Seguridad y Configuraci√≥n

#### **Variables de Entorno**
- ‚úÖ **GOOGLE_API_KEY**: Clave API de Gemini (requerida)
- ‚úÖ **LLM_MODEL**: Modelo de lenguaje (opcional, default: `models/gemini-1.5-flash`)
- ‚úÖ **EMBEDDING_MODEL**: Modelo de embeddings (opcional, default: `models/embedding-001`)
- ‚úÖ **INDEX_DIR**: Directorio de almacenamiento (opcional, default: `storage`)

#### **Archivos Sensibles**
- ‚úÖ **`.env`**: Incluido en `.gitignore` para proteger credenciales
- ‚úÖ **`storage/`**: Directorio de √≠ndices incluido en `.gitignore`
- ‚úÖ **Logs Seguros**: Informaci√≥n sensible truncada en logs

#### **Configuraci√≥n Recomendada**
```bash
# Copiar archivo de ejemplo
cp env.example .env

# Editar con tus credenciales
nano .env
```

-----

### Testing de Funcionalidades

Para probar que el chatbot responde correctamente a preguntas sobre tribus:

```bash
python test_tribal_responses.py
```

Este script prueba:
- **Preguntas sobre tribus**: Verifica que el chatbot detecte y responda apropiadamente
- **Preguntas de control**: Confirma que no mencione tribus en preguntas generales
- **Respuestas contextuales**: Valida que las respuestas sean relevantes

-----

### Mejoras Implementadas

#### **Limpieza del C√≥digo**
- ‚úÖ **Comentarios Optimizados**: Eliminados comentarios excesivos y verbosos
- ‚úÖ **Logs Seguros**: Informaci√≥n sensible truncada (solo primeros 8 caracteres del session_id)
- ‚úÖ **Variables de Entorno**: Configuraci√≥n centralizada y segura
- ‚úÖ **C√≥digo Limpio**: Estructura m√°s legible y mantenible

#### **IA Pol√≠tica Gen√©rica**
- ‚úÖ **Sin Referencias Espec√≠ficas**: Eliminadas menciones a Daniel Quintero
- ‚úÖ **Reutilizable**: Aplicable a cualquier campa√±a pol√≠tica
- ‚úÖ **Enfoque Gen√©rico**: Mantiene el estilo pol√≠tico sin personalizar

#### **Configuraci√≥n Segura**
- ‚úÖ **Variables Sensibles**: Movidas a archivo `.env`
- ‚úÖ **Valores por Defecto**: Configuraci√≥n autom√°tica si no se especifican variables
- ‚úÖ **Protecci√≥n de Credenciales**: `.env` incluido en `.gitignore`

-----

### Ejemplos de Uso

#### Preguntas sobre Tribus:
```
Usuario: "¬øMe puedes mandar el link de mi tribu?"
Bot: "Las tribus son grupos de voluntarios organizados por regi√≥n. Para obtener el enlace de tu tribu espec√≠fica, necesitas contactar a tu coordinador local. ¬øEn qu√© ciudad vives? Te puedo ayudar a contactar al coordinador de tu zona."
```

#### Preguntas Generales de Pol√≠tica:
```
Usuario: "¬øQu√© es la democracia?"
Bot: "La democracia es un sistema pol√≠tico donde el poder reside en el pueblo..."
```

-----

### API Endpoints

- **GET /**: Mensaje de bienvenida
- **POST /chat**: Endpoint principal para enviar preguntas
  - Body: `{"query": "tu pregunta", "session_id": "identificador_sesion"}`
  - Response: `{"response": {"response": "respuesta del bot"}}`
- **POST /tribal-analysis**: An√°lisis especializado de consultas sobre tribus
  - Body: `{"query": "tu pregunta", "session_id": "identificador_sesion", "user_data": {}}`
  - Response: `{"is_tribal_request": true, "ai_response": "respuesta", "referral_code": "", "user_name": "", "should_generate_link": true}`
- **POST /analytics-chat**: Consultas con datos de analytics del usuario
  - Body: `{"query": "tu pregunta", "session_id": "identificador_sesion", "user_data": {"analytics_data": {...}}}`
  - Response: `{"response": {"response": "respuesta personalizada con datos de analytics"}}`


